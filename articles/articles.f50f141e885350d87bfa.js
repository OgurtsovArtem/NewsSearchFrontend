!function(t){var e={};function s(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(o,i,function(e){return t[e]}.bind(null,i));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=8)}([function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));class o{constructor(t){this.options=t}saveKey(t,e){localStorage.setItem(t,JSON.stringify(e))}getKey(t){return JSON.parse(localStorage.getItem(t))}removeKey(t){localStorage.removeItem(t)}}},function(t,e,s){"use strict";const o={navButton:document.querySelector(".button__burger"),"navСurtain":document.querySelector(".header__nav"),navAuthButton:document.querySelector(".header__button-login"),saveArticles:document.querySelector(".link-save"),loginButton:document.querySelector(".header__button-logout"),buttonText:document.querySelector(".header__button-logout-text"),headerTitle:document.querySelector(".header__title"),headerButton:document.querySelector(".header__button-logout")};e.a=o},function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));class o{constructor(t,e){this.options=t,this.localStorage=e}navControl(){this.options.navСurtain.classList.toggle("header__nav_open"),this.options.navButton.classList.toggle("active"),this.options.headerTitle.classList.contains("header-article")&&this.colorControl()}colorControl(){this.options.navButton.classList.toggle("button_color-dark"),this.options.navButton.classList.toggle("button_color-light"),this.options.headerTitle.classList.toggle("header__title_color-dark"),this.options.headerTitle.classList.toggle("header__title_color-light"),this.options.headerButton.classList.toggle("button_color-dark"),this.options.headerButton.classList.toggle("button_color-light")}headerLogin(t){this.name=t,this.options.saveArticles.classList.remove("disabled"),this.options.loginButton.classList.remove("disabled"),this.options.navAuthButton.classList.add("disabled"),this.options.buttonText.textContent=this.name}headerLogout(){!0===confirm("Вы действительно хотите выйти")&&(this.options.saveArticles.classList.add("disabled"),this.options.loginButton.classList.add("disabled"),this.options.navAuthButton.classList.remove("disabled"),this.options.buttonText.textContent="Hacker",document.location.href="../",localStorage.clear())}"accessСheck"(){void 0!==localStorage.authorizedUser&&(console.log("я нашел!"),this.options.buttonText.textContent=this.localStorage.getKey("authorizedUser"),this.options.navAuthButton.classList.add("disabled"),this.options.loginButton.classList.remove("disabled"),this.options.saveArticles.classList.remove("disabled"))}headerListener(){this.options.loginButton.addEventListener("click",this.headerLogout.bind(this)),this.options.navButton.addEventListener("click",this.navControl.bind(this)),this.options.navAuthButton.addEventListener("click",this.navControl.bind(this))}}},function(t,e,s){"use strict";e.a={baseUrl:"https://newsartemogurtsov.students.nomoreparties.xyz"}},function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));class o{constructor(t,e){this.options=t,this.localStorage=e}login(t,e){return console.log(this.options.baseUrl+"/signin"),fetch(this.options.baseUrl+"/signin",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e})}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status)).catch(t=>{console.log(t)})}registration(t,e,s){return fetch(this.options.baseUrl+"/signup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e,name:s})}).then(o=>o.ok?o.json():(console.log(JSON.stringify({email:t,password:e,name:s})),Promise.reject("Ошибка: "+o.status))).catch(t=>{console.log(t)})}getUser(t){return console.log(t),fetch(this.options.baseUrl+"/users/me",{method:"GET",credentials:"include",headers:{authorization:"Bearer "+t}}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status))}getArticles(){return fetch(this.options.baseUrl+"/articles",{method:"GET",credentials:"include",headers:{authorization:"Bearer "+this.localStorage.getKey("key"),"Content-Type":"application/json"}}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status))}postArticles(t,e,s,o,i,n,r){return fetch(this.options.baseUrl+"/articles",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",authorization:"Bearer "+this.localStorage.getKey("key")},body:JSON.stringify({keyword:t,title:e,text:s,date:o,source:i,link:n,image:r})}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status)).catch(t=>{console.log(t)})}deleteArticles(t){return fetch(`${this.options.baseUrl}/articles/${t}`,{method:"DELETE",credentials:"include",headers:{authorization:"Bearer "+this.localStorage.getKey("key"),"Content-Type":"application/json"}})}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));class o{constructor({container:t,setFormatDate:e,idCreator:s,button:o,classCreate:i},n){this.container=t,this.setFormatDate=e,this.idCreator=s,this.button=o,this.classCreate=i,this.api=n,this.showСards=this.showСards.bind(this)}addCard(t,e,s,o,i,n,r,a,c){let l;l="Redrawing"===a?s:this.setFormatDate(s);const d=this.classCreate(this.api).create(t,e,l,o,i,n,r,a,c);this.container.appendChild(d)}render(t){t.forEach(t=>{this.addCard(t.title,t.description,t.publishedAt,t.urlToImage,t.source.name,t.url,t.id)})}renderPrivateCard(t){t.forEach(t=>{this.addCard(t.title,t.text,t.date,t.image,t.source,t.link,t._id,t.keyword,"Redrawing")})}arrayConverter(t){this.api.getArticles().then(e=>{0===e.totalResults?console.log("Ничего не найдено"):this.checkingSavedCard(e.data,t)}).catch(t=>{console.log(t)})}checkingSavedCard(t,e){t.forEach((function(t){e.forEach((function(e){t.text===e.description&&(e.id=t._id)}))})),this.newArray=e,this.showСards()}arrayControl(t){this.currentIndex=0,this.currentLimit=0,this.arrayConverter(t)}"showСards"(){for(this.currentLimit+=3,this.currentIndex;this.currentIndex<this.currentLimit&&this.currentIndex<this.newArray.length;this.currentIndex++)this.render([this.newArray[this.currentIndex]])}refreshCardList(){if(0!==this.container.childNodes.lenght)for(localStorage.removeItem("articleKey");this.container.firstChild;)this.container.removeChild(this.container.firstChild)}listener(){this.button.addEventListener("click",this.showСards)}}},function(t,e,s){"use strict";var o=t=>new Date(t).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric"});class i{constructor(t){this.api=t}create(t,e,s,o,i,n,r,a,c){const l=document.createElement("div"),d=document.createElement("button"),h=document.createElement("p"),u=document.createElement("img"),p=document.createElement("span"),g=document.createElement("h3"),m=document.createElement("p"),v=document.createElement("a"),b=document.createElement("button");b.classList.add("place-card__backet");const y=document.createElement("p");return y.classList.add("place-card__keyword"),l.classList.add("place-card"),d.classList.add("place-card__flag"),h.classList.add("place-card__prompt"),u.classList.add("place-card__image"),p.classList.add("place-card__date"),g.classList.add("place-card__title"),m.classList.add("place-card__text"),v.classList.add("place-card__link"),v.classList.add("link"),u.setAttribute("alt","Изображение"),u.setAttribute("src",""+o),v.setAttribute("target","_blank"),v.setAttribute("href",""+n),h.textContent="Войдите, чтобы сохранять статьи",p.textContent=s,g.textContent=t,m.textContent=e,v.textContent=i,l.appendChild(d),l.appendChild(h),l.appendChild(u),l.appendChild(p),l.appendChild(g),l.appendChild(m),l.appendChild(v),"Redrawing"===c&&(h.textContent="Убрать из сохранённых",l.appendChild(b),l.appendChild(y),y.textContent=a,l.removeChild(d),l.dataset.id=r,this.cardBucket=b,this.cardControlKey=c,this.bucketListener()),void 0!==r&&(l.dataset.id=r,d.classList.add("place-card__flag_active")),this.cardFlag=d,this.cardPrompt=h,this.cardTitle=g,this.cardText=m,this.cardDate=p,this.cardlink=v,this.cardImage=u,this.accessСheck(),this.placeCard=l,l}promt(){this.cardPrompt.classList.toggle("place-card__prompt_visible")}deleteCard(){this.api.deleteArticles(this.placeCard.dataset.id).then(t=>{t.ok&&(console.log("удалилась"),this.cardFlag.classList.remove("place-card__flag_active"),this.removelistener(),"Redrawing"===this.cardControlKey&&this.placeCard.remove())}).catch(t=>{console.log(t)})}"accessСheck"(){void 0!==localStorage.authorizedUser?this.loginListener():this.promtListener()}saveCard(){console.log(localStorage.getItem("articleKey")),this.api.postArticles(JSON.parse(localStorage.getItem("articleKey")),this.cardTitle.textContent,this.cardText.textContent,this.cardDate.textContent,this.cardlink.textContent,this.cardlink.href,this.cardImage.src).then(t=>{void 0!==t?(console.log("Сохранилась"),this.placeCard.dataset.id=t.id,console.log(this.placeCard.dataset.id),this.cardFlag.classList.add("place-card__flag_active")):(this.cardPrompt.textContent="Не могу сохранить:(",this.cardPrompt.classList.toggle("place-card__prompt_visible"))}).catch(t=>{console.log(t)})}flagControl(){this.cardFlag.classList.contains("place-card__flag_active")?this.deleteCard():this.saveCard()}removelistener(){"Redrawing"===this.cardControlKey?(this.cardBucket.removeEventListener("mouseout",this.promt.bind(this)),this.cardBucket.removeEventListener("mouseover",this.promt.bind(this)),this.cardBucket.removeEventListener("click",this.deleteCard.bind(this)),console.log("я удалил слушатель")):(this.cardFlag.removeEventListener("mouseout",this.promt.bind(this)),this.cardFlag.removeEventListener("mouseover",this.promt.bind(this)),this.cardFlag.removeEventListener("click",this.flagControl.bind(this)),console.log("Я удалил слшуатель с флага"))}promtListener(){this.cardFlag.addEventListener("mouseout",this.promt.bind(this)),this.cardFlag.addEventListener("mouseover",this.promt.bind(this))}loginListener(){this.cardFlag.addEventListener("click",this.flagControl.bind(this))}bucketListener(){this.cardBucket.addEventListener("mouseout",this.promt.bind(this)),this.cardBucket.addEventListener("mouseover",this.promt.bind(this)),this.cardBucket.addEventListener("click",this.deleteCard.bind(this))}}const n={container:document.querySelector(".place-list__container"),setFormatDate:o,button:document.querySelector(".place-list__button"),classCreate:t=>new i(t)};e.a=n},,function(t,e,s){"use strict";s.r(e);var o=s(0),i=s(1),n=s(2),r=s(3),a=s(4),c=s(6),l=s(5);var d=(t,e="Вы забыли передать варианты")=>e[(t=Math.abs(t))%100>4&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]];var h={topicKeywords:document.querySelector(".topic__keywords"),title:document.querySelector(".topic__title"),keywords:document.querySelector(".keywords"),keynumber:document.querySelector(".keynumber"),union:document.querySelector(".topic__union"),declOfNum:d};const u=new o.a,p=new n.a(i.a,u);p.headerListener(),p.accessСheck();const g=new a.a(r.a,u),m=new l.a(c.a,g);new class{constructor(t,e,s,o){this.cardList=o,this.localStorage=s,this.mainApi=e,this.options=t}"accessСheck"(){void 0!==localStorage.authorizedUser?(this.savedCard(),this.options.keywords.classList.remove("disabled")):document.location.href="../"}topicControl(t,e){console.log(e),this.options.title.textContent=`\n      ${this.localStorage.getKey("authorizedUser")}, у вас \n      ${t} ${this.options.declOfNum(t,["сохранённая","сохранённые","сохранённых"])} \n      ${this.options.declOfNum(t,["статья","статьи","статей"])}\n      `,this.options.keywords.textContent=`${e[0]}, ${e[1]}`,t>2&&e.length>2?this.options.keynumber.textContent=`\n        ${e.length-2}-${this.options.declOfNum(e.length-2,["му","м","и"])}\n        ${this.options.declOfNum(e.length-2,["другому","другим","другим"])}\n        `:e.length<2&&0!==t?(this.options.keywords.textContent=""+e[0],this.options.keynumber.textContent="",this.options.union.textContent=""):0==t?(this.options.title.textContent=this.localStorage.getKey("authorizedUser")+", у вас нет сохранённых статей",this.options.topicKeywords.classList.add("disabled")):(this.options.keywords.textContent=""+e[0],this.options.keynumber.textContent=""+e[1])}savedCard(){this.mainApi.getArticles().then(t=>{if(0===t.totalResults)console.log("Не найдено добавленных карт");else{const e=t.data.reduce((t,e)=>(t[e.keyword]||(t[e.keyword]=0),t[e.keyword]++,t),[]),s=Object.keys(e).sort((function(t,s){return e[s]-e[t]}));this.topicControl(t.data.length,s),this.cardList.renderPrivateCard(t.data.reverse())}}).catch(t=>{console.log(t)})}}(h,g,u,m).accessСheck()}]);