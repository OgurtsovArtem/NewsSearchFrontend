!function(t){var e={};function s(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(o,n,function(e){return t[e]}.bind(null,n));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e),s.d(e,"newsApi",(function(){return C})),s.d(e,"cardList",(function(){return E}));var o={baseUrl:"https://newsapi.org/v2/",sortBy:"popularity",pageSize:"100",apiKey:"cefe7cbdc6b94355ae9ee08e1066ea96",endpoint:"everything"};var n={baseUrl:"http://localhost:3000",registrationPopup:document.querySelector(".popup-registration"),successfulPopup:document.querySelector(".popup-successful"),loginPopup:document.querySelector(".popup-login")};var i=t=>new Date(t).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric"});var r=()=>"f"+(~~(1e8*Math.random())).toString(16);var a={container:document.querySelector(".place-list__container"),setFormatDate:i,idCreator:r,button:document.querySelector(".place-list__button")};var c={validationLenght:"Должно быть от 2 до 30 символов",validationNull:"Это обязательное поле",validationEmail:"Неправильный формат Email"};const l={words:c,formElement:[...document.querySelector(".popup-login").querySelectorAll(".popup__input")],formImput:document.forms.login,popupButton:document.querySelector(".button__login")},d={words:c,formElement:[...document.querySelector(".popup-registration").querySelectorAll(".popup__input")],formImput:document.forms.registration,popupButton:document.querySelector(".button__registration")};class u{constructor({words:t,formElement:e,formImput:s,popupButton:o}){this.words=t,this.formElement=e,this.formImput=s,this.popupButton=o}setEventListeners(){let t=!0;this.formElement.forEach(e=>(this.checkInputValidity(e)||(t=!1),t)),this.setSubmitButtonState(t,this.popupButton)}checkInputValidity(t){let e=t.id;const s=t.nextElementSibling.id;return!0===t.validity.tooShort?(e+="-error",e===s&&(t.nextElementSibling.textContent=this.words.validationLenght),!1):!0===t.validity.valueMissing?(e+="-error",e===s&&(t.nextElementSibling.textContent=this.words.validationNull),!1):!0===t.validity.typeMismatch?(e+="-error",e===s&&(t.nextElementSibling.textContent=this.words.validationEmail),!1):(t.nextElementSibling.textContent="",!0)}setSubmitButtonState(t,e){!0===t?(e.removeAttribute("disabled"),e.classList.add("popup__button_enable")):(e.setAttribute("disabled",!0),e.classList.remove("popup__button_enable"))}listener(){this.formImput.addEventListener("input",this.setEventListeners.bind(this))}}var p=(t=0)=>{const e=new Date;e.setDate(e.getDate()-t);const s=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();return`${s}-${o<10?"0"+o:o}-${n<10?"0"+n:n}`};var h={imput:document.querySelector(".intro__search"),setTimeAgo:p,preloader:document.querySelector(".preloader"),section:document.querySelector(".place-list")};const m=[...document.querySelectorAll(".popup__close")];var g={element:document.querySelector(".popup-login"),buttonOpen:document.querySelector(".header__button-login"),buttonClose:m[0],secondButton:document.querySelector(".button-registration"),secondForm:document.querySelector(".popup-registration")};class b{constructor(t){this.option=t}open(){this.option.element.classList.remove("disabled")}close(){this.option.element.classList.add("disabled")}listener(){this.option.buttonOpen.addEventListener("click",this.open.bind(this)),this.option.buttonClose.addEventListener("click",this.close.bind(this))}}const f=[...document.querySelectorAll(".popup__close")];var y={element:document.querySelector(".popup-registration"),buttonOpen:document.querySelector(".popup__button-another-form"),buttonClose:f[1],secondButton:document.querySelector(".button-login-one"),secondForm:document.querySelector(".popup-login")};const L=[...document.querySelectorAll(".popup__close")];var v={element:document.querySelector(".popup-successful"),buttonClose:L[2],secondButton:document.querySelector(".button-login-two"),secondForm:document.querySelector(".popup-login")};var S={formLogin:document.forms.login,formRegistration:document.forms.registration};const C=new class{constructor({baseUrl:t,endpoint:e,sortBy:s,pageSize:o,apiKey:n}){this.baseUrl=t,this.endpoint=e,this.sortBy=s,this.apiKey=n,this.pageSize=o}getNews(t,e){return fetch(`${this.baseUrl}${this.endpoint}?q=${t}&from=${e(7)}&sortBy=${this.sortBy}&pageSize=${this.pageSize}&apiKey=`+this.apiKey).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status))}}(o),_=new class{constructor(t){this.options=t}login(t,e){return fetch(this.options.baseUrl+"/signin",{method:"POST",credentials:"include",mode:"no-cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify({email:t,password:e})}).then(t=>t.ok?(this.options.loginPopup.classList.add("disabled"),t.json()):Promise.reject("Ошибка: "+t.status))}registration(t,e,s){return fetch(this.options.baseUrl+"/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e,name:s})}).then(o=>o.ok?(this.options.registrationPopup.classList.add("disabled"),this.options.successfulPopup.classList.remove("disabled"),o.json()):(console.log(JSON.stringify({email:t,password:e,name:s})),console.log(o.message),Promise.reject("Ошибка: "+o.status))).catch(t=>{console.log(t)})}getUser(){return fetch(this.options.baseUrl+"/users/me",{method:"GET",credentials:"include",mode:"no-cors",headers:{authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI1ZmQ0NDQ2ZjY1NWQ4YjQ1NzczOTc3MTEiLCJpYXQiOjE2MDc3NDc0NDYsImV4cCI6MTYwODM1MjI0Nn0.OEYUuRgsKUfwwpt_0cxWFnCqOs3kEnIzcqY3CUysTuo"}}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status))}getArticles(){return fetch(this.options.baseUrl+"/articles",{method:"GET",mode:"no-cors",headers:{authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI1ZmQ0NDQ2ZjY1NWQ4YjQ1NzczOTc3MTEiLCJpYXQiOjE2MDc3NDc0NDYsImV4cCI6MTYwODM1MjI0Nn0.OEYUuRgsKUfwwpt_0cxWFnCqOs3kEnIzcqY3CUysTuo","Content-Type":"application/json"}}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status))}postArticles(t,e,s,o,n,i,r){return fetch(this.options.baseUrl+"/signup",{method:"POST",headers:{authorization:this.options.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({keyword:t,title:e,text:s,date:o,source:n,link:i,image:r})}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status))}deleteArticles(t){return fetch(`${this.options.baseUrl}/cards/${t}`,{method:"DELETE",headers:{authorization:this.options.headers.authorization,"Content-Type":"application/json"}})}}(n);_.getUser(),_.getArticles();const E=new class extends class{constructor(){}create(t,e,s,o,n,i,r){const a=document.createElement("div"),c=document.createElement("button"),l=document.createElement("p"),d=document.createElement("img"),u=document.createElement("span"),p=document.createElement("h3"),h=document.createElement("p"),m=document.createElement("a");return a.classList.add("place-card"),c.classList.add("place-card__flag"),l.classList.add("place-card__prompt"),d.classList.add("place-card__image"),u.classList.add("place-card__date"),p.classList.add("place-card__title"),h.classList.add("place-card__text"),m.classList.add("place-card__link"),m.classList.add("link"),d.setAttribute("alt","Изображение"),d.setAttribute("src",""+o),m.setAttribute("target","_blank"),m.setAttribute("href",""+i),l.textContent="Войдите, чтобы сохранять статьи",u.textContent=s,p.textContent=t,h.textContent=e,m.textContent=n,a.dataset.id=r,a.appendChild(c),a.appendChild(l),a.appendChild(d),a.appendChild(u),a.appendChild(p),a.appendChild(h),a.appendChild(m),a}deleteCard(){}saveCard(){}}{constructor({container:t,setFormatDate:e,idCreator:s,button:o}){super(),this.container=t,this.setFormatDate=e,this.idCreator=s,this.button=o,this.showСards=this.showСards.bind(this)}addCard(t,e,s,o,n,i){const r=this.create(t,e,this.setFormatDate(s),o,n,i,this.idCreator());this.container.appendChild(r)}render(t){this.cardArr=t,this.cardArr.forEach(t=>{this.addCard(t.title,t.description,t.publishedAt,t.urlToImage,t.source.name,t.url)})}array2(t){this.array=t,this.currentIndex=0,this.currentLimit=0}"showСards"(t){for(t.preventDefault(),this.currentLimit+=3,this.currentIndex;this.currentIndex<this.currentLimit&&this.currentIndex<this.array.length;this.currentIndex++)this.render([this.array[this.currentIndex]])}refreshCardList(){if(0!==this.container.childNodes.lenght)for(console.log(this.array);this.container.firstChild;)this.container.removeChild(this.container.firstChild)}listener(){this.button.addEventListener("click",this.showСards)}}(a);E.listener();const w=new u(l),I=new u(d);w.listener(),I.listener();const O=new class{constructor({imput:t,setTimeAgo:e,preloader:s,section:o},n,i){this.imput=t,this.cardList=n,this.setTimeAgo=e,this.newsApi=i,this.preloader=s,this.section=o,this.keyword=this.keyword.bind(this)}keyword(t){t.preventDefault(),this.open();const e=document.forms.search.elements.search.value;this.newsApi.getNews(e,this.setTimeAgo).then(e=>{this.cardList.refreshCardList(),this.cardList.array2(e.articles),this.cardList.showСards(t)}).catch(t=>{console.log(t)}).finally(()=>{this.close()})}open(){this.preloader.classList.remove("disabled"),this.section.classList.add("disabled")}close(){this.preloader.classList.add("disabled"),this.section.classList.remove("disabled")}}(h,E,C);document.forms.search.addEventListener("submit",O.keyword);new class extends b{constructor({element:t,buttonOpen:e,buttonClose:s,secondButton:o}){super({element:t,buttonOpen:e,buttonClose:s}),super.listener(),this.element=t,this.secondButton=o}closeLogin(){this.element.classList.add("disabled")}listenerLogin(){this.secondButton.addEventListener("click",this.closeLogin.bind(this))}}(g).listenerLogin();new class extends b{constructor({element:t,buttonOpen:e,buttonClose:s,secondButton:o,secondForm:n}){super({element:t,buttonOpen:e,buttonClose:s}),super.listener(),this.element=t,this.secondButton=o,this.secondForm=n}openRegistration(){this.secondForm.classList.remove("disabled")}closeRegistration(){this.element.classList.add("disabled")}listenerRegistration(){this.secondButton.addEventListener("click",this.openRegistration.bind(this)),this.secondButton.addEventListener("click",this.closeRegistration.bind(this))}}(y).listenerRegistration();new class{constructor({element:t,buttonClose:e,secondForm:s,secondButton:o}){this.element=t,this.secondForm=s,this.buttonClose=e,this.secondButton=o}openSuccessful(){this.secondForm.classList.remove("disabled")}closeSuccessful(){this.element.classList.add("disabled")}listenerSuccessful(){this.buttonClose.addEventListener("click",this.closeSuccessful.bind(this)),this.secondButton.addEventListener("click",this.openSuccessful.bind(this)),this.secondButton.addEventListener("click",this.closeSuccessful.bind(this))}}(v).listenerSuccessful();const q=new class{constructor({formLogin:t,formRegistration:e},s){this.formLogin=t,this.formRegistration=e,this.api=s,this.submitLogin=this.submitLogin.bind(this),this.submitRegistration=this.submitRegistration.bind(this)}submitLogin(t){t.preventDefault();const e=this.formLogin.elements.email.value,s=this.formLogin.elements.password.value;this.api.login(e,s).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}submitRegistration(t){t.preventDefault();const e=this.formRegistration.elements.password.value,s=this.formRegistration.elements.email.value,o=this.formRegistration.elements.name.value;this.api.registration(s,e,o).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}}(S,_),j=document.forms.login,x=document.forms.registration;j.addEventListener("submit",q.submitLogin),x.addEventListener("submit",q.submitRegistration)}]);